# How to set up a **forgot my password** system in laravel(Mailtrap.io).

This guide will explain how to setup a reset password system in laravel using an emailing service, assuming you've already
built your basic **singin/login** system so that the only thing to implement is the system in quiestion.
For this example we'll use Mailtrap as our emailing service.

---

## âœ… Prerequisites

- Laravel app can be loaded with no issues
- signin/login system has already been created.

--- 

## 1. Configure Email settings in .env

Go to mailtrap.io and create an account, go to sandbox and create a new inbox,go to your new inbox, in the integration
section click on **php** down below and follow the code example to configure emial settings according to your credentias.

Open the .env file and configure your mail settings. Laravel uses the MAIL_DRIVER, MAIL_HOST, MAIL_PORT, MAIL_USERNAME, 
and MAIL_PASSWORD variables to send emails. Choose an appropriate mail driver (e.g., SMTP) and provide the necessary credentials.

e.g

MAIL_DRIVER=smtp
MAIL_ENCRYPTION=tls
MAIL_HOST=your-smtp-host
MAIL_PORT=your-smtp-port
MAIL_USERNAME=your-smtp-username
MAIL_PASSWORD=your-smtp-password
MAIL_FROM_ADDRESS=your-email@example.com
MAIL_FROM_NAME="${APP_NAME}"

---

## 2. Database configuration.

Laravel uses a database table **password_resets** to store token and email information 
for password reset requests. If this table doesnt exist already, run migrations

```bash`
php artisan migrate


---

## 3. Create routes.

We'll need to create the necessary routes to redirect the user to certain pages so they can reset their password and others to actually trigger the process of sending the reset link or actually just reset the password.

# a. The first route's whole purpose is to redirect the user to the page containing the form where they enter their email to request the reset password link:

/routes/web.php:

Route::get('/forgot-password', [ForgotPasswordController::class, 'create'])->name('password.create');

///
**NOTE**
The **ForgotPasswordController** class has a method called **create** that handles the redirect part, we manually define this method later on.
///

# b. The second route will be called upon when the user submits previous form(where they enter their email), so this route calls a method called **store** that will send the reset link to their email(in this case the email will be sent to your mailtrap inbox), we define thie method later on.

/routes/web.php:

Route::post('/forgot-password', [ForgotPasswordController::class, 'store'])->name('password.email');

///
**NOTE**
The **ForgotPasswordController** class has a method called **store** that handles the send reset link part, we manually define this method later on.
///

# c. The third route is for redirecting user to change their password.

This route will be called when the user clicks on the reset password link, this route's URL contains a **token** which gets stored in the
**password_resets** database table which has an expiration time of 30min and is for a one time use to enhance security, meaning when the password is successfully updated this token is deleted from the table.

This route calles a method within **ResetPasswordController** which uses one parameter called **$token** which contains the token in the
**password_resets** table, when the reset password form is submitted it asks for this token for verification so it is importan that we pass it to the
**reset-password.blade.php** file, we define this method later on anyways so we can see how it's done.

/routes/web.php:

Route::get('/reset-password/{token}', [ResetPasswordController::class, 'create'])->name('password.reset');




## 4. Create reset password views.

Inside the views folder we create another folder called **resources/views/aut/h**, then we created 2 
new blade templates inside **resources/views/auth/**, the first one should be called **forgot-password.blade.php** 
and the other one **reset-password.blade.php**.

- The **forgot-password.blade.php** file should contain a form where the user can enter the email for the the account they
wanna reset their password for, e.g:

resources/views/auth/forgot-password.blade.php:





## 5. Create reset password controllers

```bash`
php artisan make:controller ForgotPasswordController
php artisan make:controller ResetPasswordController

---

Now that the controllers have been created we create the necessary methods and import the necessary facade.

- For both controllers we import the same facade at the top of the file:

use Illuminate\Support\Facades\Password;

---

- For the **ForgotPasswordController** we first create the method that will redirect the user the the page where they
can request the reset link, they will be asked to introduce the email for the account they wanna reset the password for:

public function create() {
    return view('auth.forgot-password');
}


